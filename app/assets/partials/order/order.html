<div class="butter-bar active success back" 
     ng-cloak ng-show="cart.hasError()" >
  <div class="butter-bar-message">
    Votre commande nécessite quelques modifications
  </div>
</div>

<div tabindex="-1"  id="null" class="screen-content">
  <aside ng-include="getCover()" class="cover cover-home cover-order img-loaded" ng-class="{'session':user.isAuthenticated()}">
  </aside>


   <section class="wrapper" tabindex="-1" ng-controller="OrderCtrl">
      <div class="wrapper-inner wide"  >


        <!--                               -->
        <!-- CATEGORIES PRODUITS/BOUTIQUES -->
        <!--                               -->
                          
         <div  class="bucket post-bucket homepage-posts">
              <h3 class="article-group-title text-center" >
                Vous allez valider une nouvelle commande
              </h3>  
              <div class="stepwizard">
                  <div class="stepwizard-row">
                      <div class="stepwizard-step">
                          <button type="button" class="btn btn-default btn-circle" disabled="disabled">1</button>
                          <p>Shopping</p>
                      </div>
                      <div class="stepwizard-step">
                          <button type="button" class="btn btn-primary btn-circle">2</button>
                          <p>Valider</p>
                      </div>
                      <div class="stepwizard-step">
                          <button type="button" class="btn btn-default btn-circle" disabled="disabled">3</button>
                          <p>Payment</p>
                      </div> 
                  </div>
              </div>

         </div>
         <div>
           <div class="alert alert-warning" ng-cloak ng-show="user.email.status !== true" >
                Vous devez <a href="/account/profile">valider votre addresse email</a> pour passer cette commande.
           </div>
         </div>

         <!-- ORDER CART -->         
         <div>
           <div class="text-center">
                <h2 class="article-group-title">VOTRE COMMANDE</h2>
            </div>
            </span>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Produit</th>
                        <th>Qty</th>
                        <th class="text-center">Prix</th>
                        <th class="text-center">Total</th>
                    </tr>
                </thead>
                <tbody>
                  <tr  ng-repeat="item in cart.items" >                    
                    <td class="col-md-8"><em>
                      <a href="/products/{{item.sku}}" >{{item.part}} - {{item.title}}</a></em>
                      <div ng-show="item.error" class="alert alert-warning">{{item.error}}</div>
                      <div class="btn-group btn-group-xs pull-right hidden-xs">
                        <button type="button" class="btn btn-default" ng-click="cart.add(item, true)"><i class="icon-plus"></i></button>
                        <button type="button" class="btn btn-default" ng-click="cart.remove(item,true)"><i class="icon-minus"></i></button>
                        <button type="button" class="btn btn-default" ng-click="cart.clear(item)"><i class="icon-remove"></i></button>
                      </div>
                    </td>
                    <td class="col-md-1" style="text-align: center">{{item.quantity}}</td>
                    <td class="col-md-1 text-center">{{item.price|number:2}}</td>
                    <td class="col-md-2 text-center">{{item.price*item.quantity|number:2}}</td>
                  </tr>
                    <tr>
                        <td class="text-right" colspan="3">
                          <p><strong>Soustotal: </strong></p>
                          <p><strong>Paiement {{config.shop.order.gateway[cart.config.payment].label}}: {{cart.tax()*100|number:1}}% </strong>
                          </p>
                          <p><strong>Livraison: </strong></p>
                        </td>
                        <td class="text-center">
                          <p><strong>{{cart.total()|number:2}} </strong></p>
                          <p><strong>{{cart.tax()*cart.total()|number:2}} </strong></p>
                          <p><strong>{{cart.shipping()|number:2}} </strong></p>
                      </td>
                    </tr>
                    <tr>
                        <td>   </td>
                        <td>   </td>
                        <td class="text-right"><h4><strong>Total: </strong></h4></td>
                        <td class="text-center text-danger"><h4><strong>{{cart.grandTotal()|number:2}} CHF</strong></h4></td>
                    </tr>
                </tbody>
            </table>
         </div>


         <!-- SHIPPING PAYMENT -->         
         <div ng-show="user.addresses.length" ng-class="{'has-error':!cart.config.payment}">
           <h5 class="article-group-title ">Choisir le mode de payment</h5>
            <select class="form-control input-lg" ng-model="cart.config.payment" ng-change="updateGateway()">
              <option value="">-- Sélection d'un mode de paiement --</option>
              <option value="{{$index}}" ng-repeat="gateway in config.shop.order.gateway">{{gateway.label}}</option>
            </select>           
         </div>


         <!-- SHIPPING DATE -->         
         <div ng-show="user.addresses.length">
           <h5 class="article-group-title ">Choisir la date de livraison</h5>
            <select class="form-control input-lg" ng-model="cart.config.shipping" ng-options="date.id as date| dateLabel:'' for date in shippingDays">
            </select>
            <p class="help-block">En choisissant ce créneau horaire, vous confirmez être présent pour la réception de votre commande.</p>

         </div>


         <!-- SHIPPING ADDRESS -->         
         <div ng-hide="user.addresses.length">
           <div class="alert alert-warning" >
             <strong>Votre profile est incomplet!</strong> 
             Pour passer une commande, vous devez indiquer <a href="/account/profile">au moins une adresse de livraison.</a>
           </div>
         </div>            

         <div ng-show="user.addresses.length">
           <h5 class="article-group-title ">Choisir l'adresse de livraison </h5>
            <select class="form-control input-lg" ng-model="cart.config.address">
              <option ng-repeat="a in user.addresses" ng-selected="a.primary" ng-value="$index">
                {{a.name}} - {{a.streetAdress}} {{a.postalCode}}
              </option>
            </select>
         </div>


        <!-- ORDER -->
        <div  class="row wrapheight" >

                  <div class="row">
                      <label>
                        <input type="checkbox"  value="true" ng-model="cg">
                        J'ai lu et j'accepte les conditions générales de vente et de livraison.
                      </label>
                      <button type="button" class="btn btn-success btn-lg btn-block"
                              ng-disabled="!cg||!user.isReady()||!user.hasPrimaryAddress()||!cart.config.payment||!cart.items.length||WaitText"  
                              ng-click="terminateOrder()" >
                          <i ng-class="{'icon-gear':WaitText}"></i>
                          Aller à la caisse  
                      </button>
                  </div>
        </div>

        <footer class="wrapper-footer wide">
          <a class="wrapper-footer-link" title="Qui sommes nous" href="/about">Qui sommes nous</a>
          <a class="wrapper-footer-link" title="Lire notre charte " href="/charte">Lire notre charte</a>
          <a class="wrapper-footer-link" title="La FAQ" href="/help-center/faq">FAQ</a>
          <a class="wrapper-footer-link" title="Developpeurs" href="" backend-url="href">API</a>
        </footer>
      </div>
   </section>
</div>
